<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns#">
<head>
    <meta charset='utf-8'>
    <title>Flow | 检测第三方模块调用代码</title>
    <link href='https://fonts.googleapis.com/css?family=Roboto+Mono' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css" />
    <link type="text/css" rel="stylesheet" href="/flowtype/assets/default.css">
    <link type="text/css" rel="stylesheet" href="/flowtype/assets/syntax.css">
    <link rel='shortcut icon' href='/flowtype/static/favicon.png'>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta property="og:title" content="检测第三方模块调用代码" />
    <meta property="og:site_name" content="flowtype">
    <meta property='og:description' content='Flow is a static type checker for
    JavaScript.'>
    <meta property='og:image' content='http://flowtype.org/static/flow-og-image.png'>
    <meta property='og:url' content="http://flowtype.org/docs/third-party.html">
    
    <meta property='og:type' content='website'>
    
    <script type="text/javascript" src="/flowtype/assets/prelude.js"></script>
    <link rel="alternate" type="application/rss+xml" title="Flow" href="http://flowtype.org/blog/feed.xml">
</head>
<body class="">

<header class='topbar'><nav class='width'>
<a href='/flowtype/'>
  <img src="/flowtype/assets/flow-logo.png" alt="Flow logo" class="logo" />
</a>
    <ul>
      <li><a href="/flowtype/docs/getting-started.html#_"
           class="active" >
          文档
      </a></li>
      <li><a href="/flowtype/try/"
          >
          试试
      </a></li>
      <li><a href="/flowtype/support.html"
          >
          支持
      </a></li>
      <li><a href="/flowtype/blog"
          >
          博客
      </a></li>
      <li>
        <input id="algolia-doc-search" type="text" placeholder="Search docs..." />
      </li>
    </ul>
    <ul class="external">
      <li><a href="http://github.com/facebook/flow">官方GitHub</a>
      <li><a href="http://github.com/zhenyong">译者GitHub</a>
    </ul>
</nav></header>


<section class='content'><div class='width'>

<nav class='toc'>
  
    <section>
      <h3>Quick Start</h3>
      <ul>
        
          <li>
            <a href="/flowtype/docs/getting-started.html#_">
              Flow 起步
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/five-simple-examples.html#_">
              五个简单例子
            </a>
            
          </li>
        
      </ul>
    </section>
  
    <section>
      <h3>使用指南</h3>
      <ul>
        
          <li>
            <a href="/flowtype/docs/new-project.html#_">
              开始一个新的 Flow 项目
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/existing.html#_">
              在已有的代码上跑 Flow
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/type-annotations.html#_">
              Adding 类型注解
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/third-party.html#_" class="active">
              检测第三方模块调用代码
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/running.html#_">
              运行 Flow 代码
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/troubleshooting.html#_">
              分析&解决
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/cli.html#_">
              命令行工具
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/advanced-configuration.html#_">
              Advanced Configuration
            </a>
            
          </li>
        
      </ul>
    </section>
  
    <section>
      <h3>Language Reference</h3>
      <ul>
        
          <li>
            <a href="/flowtype/docs/quick-reference.html#_">
              Quick Reference
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/builtins.html#_">
              Built-in Types
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/syntax.html#_">
              Syntax
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/arrays.html#_">
              Arrays and Tuples
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/classes.html#_">
              Classes
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/objects.html#_">
              Objects
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/functions.html#_">
              Functions
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/nullable-types.html#_">
              Maybe Types
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/destructuring.html#_">
              Destructuring
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/type-aliases.html#_">
              Type Aliases
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/union-intersection-types.html#_">
              Union and Intersection Types
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/typeof.html#_">
              Typeof types
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/dynamic-type-tests.html#_">
              Dynamic Type Tests
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/disjoint-unions.html#_">
              Disjoint Unions
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/modules.html#_">
              Modules
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/declarations.html#_">
              Declarations
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/react.html#_">
              React
            </a>
            
          </li>
        
      </ul>
    </section>
  
</nav>


<article class='withtoc'>
    <h1>检测第三方模块调用代码</h1>
    <p></p>

    <p>大多数 JavaScript 应用程序都依赖第三方库。
这节指南会展示，当项目引用外部资源时如何使用 Flow，至于检查第三方的源码，当然不必了。</p>

<h2>接口文件<a id="section" class="hashref"></a><a href="#section" class="hash">#</a></h2>

<p>Flow 支持 <em>接口文件</em>，目的是帮助 Flow 理解那些不是你写的第三方代码。
这些文件定义了一个第三方模块的接口，包括类型，同时又跟第三方库源码分离。
你不需要改变第三方源码就能使用接口文件，同时，你的代码会根据接口文件中的类型作检测。</p>

<p>整个工作流是这样的：</p>

<ul>
  <li>
    <p>不要碰第三方源码，也不需要给它们加 <code class="highlighter-rouge">@flow</code></p>
  </li>
  <li>
    <p>给第三方库增加一个或多个接口文件，放在项目下的某个目录内 - 例如 <code class="highlighter-rouge">interfaces</code> 目录</p>
  </li>
  <li>
    <p>接着告诉 Flow 使用这些接口文件，可以通过 <code class="highlighter-rouge">flow start --lib  &lt;path to your interface files&gt;</code> 命令或者在配置文件 <code class="highlighter-rouge">.flowconfig</code> 中指明</p>
  </li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>[libs]
interfaces/
</code></pre>
</div>

<h2>例子<a id="section-1" class="hashref"></a><a href="#section-1" class="hash">#</a></h2>

<p>演示下整个过程，我们选择 <a href="http://underscorejs.org/">Underscore</a> 库。
下面代码使用了 Underscore：</p>

<div class="language-js highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12</pre></td><td class="code"><pre><span class="cm">/* @flow */</span>

<span class="kd">var</span> <span class="nx">pizzas</span> <span class="o">=</span> <span class="p">[</span>
  <span class="p">{</span> <span class="na">title</span><span class="p">:</span> <span class="s1">'Margherita'</span><span class="p">,</span> <span class="na">vegetarian</span><span class="p">:</span> <span class="kc">true</span> <span class="p">},</span>
  <span class="p">{</span> <span class="na">title</span><span class="p">:</span> <span class="s1">'Pepperoni'</span><span class="p">,</span> <span class="na">vegetarian</span><span class="p">:</span> <span class="kc">false</span> <span class="p">},</span>
  <span class="p">{</span> <span class="na">title</span><span class="p">:</span> <span class="s1">'Four cheese'</span><span class="p">,</span> <span class="na">vegetarian</span><span class="p">:</span> <span class="kc">true</span> <span class="p">},</span>
  <span class="p">{</span> <span class="na">title</span><span class="p">:</span> <span class="s1">'Hawaiian'</span><span class="p">,</span> <span class="na">vegetarian</span><span class="p">:</span> <span class="kc">false</span> <span class="p">},</span>
<span class="p">];</span>

<span class="kd">function</span> <span class="nx">vegetarianPizzas</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">findWhere</span><span class="p">(</span><span class="nx">pizzas</span><span class="p">,</span> <span class="p">{</span><span class="na">vegetarian</span><span class="p">:</span> <span class="kc">true</span><span class="p">});</span>
<span class="p">}</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>运行 <code class="highlighter-rouge">flow</code>， 毫无意外的出现错误:</p>

<div class="language-text cli-error highlighter-rouge"><pre class="highlight"><code>underscore_example.js:11:10,10: unknown global name: _
</code></pre>
</div>

<p>This is because Flow doesn’t know anything about the global variable <code class="highlighter-rouge">_</code>. To fix this we need to create an interface file for Underscore. If we set the <code class="highlighter-rouge">[libs]</code> configuration to <code class="highlighter-rouge">interfaces/</code>, Flow will look for any <code class="highlighter-rouge">.js</code> files located inside that directory for declarations.</p>

<p>这是因为 Flow 不认识全局变量 <code class="highlighter-rouge">_</code>.
要解决这个问题，需要为 Underscore 创建一个接口文件。
如果我们配置 <code class="highlighter-rouge">[libs]</code> 为 <code class="highlighter-rouge">interfaces/</code>，
Flow 就会查找 interfaces/ 目录下的所有 <code class="highlighter-rouge">.js</code> 文件作为接口定义</p>

<div class="language-js highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6</pre></td><td class="code"><pre><span class="c1">// interfaces/underscore.js</span>
<span class="nx">declare</span> <span class="kr">class</span> <span class="nx">Underscore</span> <span class="p">{</span>
  <span class="nx">findWhere</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">list</span><span class="err">:</span> <span class="nb">Array</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">,</span> <span class="nx">properties</span><span class="err">:</span> <span class="p">{})</span><span class="err">:</span> <span class="nx">T</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">declare</span> <span class="kd">var</span> <span class="nx">_</span><span class="err">:</span> <span class="nx">Underscore</span><span class="p">;</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>这里只是描述了 Underscore（部分）接口，忽略了很多其它方法。有了这个接口文件，Flow 也不需要
理解 Underscore 的源码。</p>

<p>如果我们配置好 <code class="highlighter-rouge">.flowconfig</code></p>

<div class="highlighter-rouge"><pre class="highlight"><code>[libs]
interfaces/
</code></pre>
</div>

<p>重新运行 flow，错误没了</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$&gt; </span>flow
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>Found 0 errors
</code></pre>
</div>

<p>现在你随意修改代码，调用 Underscore 的方法重现错误，然后就能证实现在是根据接口定义文件来检测的。</p>

<p>给一个库定义接口文件的时候，如果你不想 Flow 检测某个值，你可是使用 <code class="highlighter-rouge">any</code> 类型。
这让你只关注用的，然后逐步定义接口文件。
查看这篇文档 <a href="declarations.html">声明</a>，了解更多详情。</p>



    <p class="docs-prevnext">
      
        <a href="/flowtype/docs/type-annotations.html#_">&larr; Prev</a>
      
      
        <a class="right" href="/flowtype/docs/running.html#_">Next &rarr;</a>
      
    </p>

    <p class="edit-page-block">
      You can
      <a href="https://github.com/facebook/flow/tree/master/website/docs/02-third-party.md" target="_blank">
        edit this page on GitHub
      </a>
      and send us a pull request!
    </p>

    <a id="_"></a>
</article>

</div></section>

<footer><div class='width'>
    &copy; Copyright 2014 - 2016, Facebook Inc.
</div></footer>

<script>require(['default']);</script>
</body>
</html>

