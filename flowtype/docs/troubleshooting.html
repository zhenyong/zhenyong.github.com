<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns#">
<head>
    <meta charset='utf-8'>
    <title>Flow | 干掉错误</title>
    <link href='https://fonts.googleapis.com/css?family=Roboto+Mono' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css" />
    <link type="text/css" rel="stylesheet" href="/flowtype/assets/default.css">
    <link type="text/css" rel="stylesheet" href="/flowtype/assets/syntax.css">
    <link rel='shortcut icon' href='/flowtype/static/favicon.png'>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta property="og:title" content="干掉错误" />
    <meta property="og:site_name" content="flowtype">
    <meta property='og:description' content='Flow is a static type checker for
    JavaScript.'>
    <meta property='og:image' content='http://flowtype.org/static/flow-og-image.png'>
    <meta property='og:url' content="http://flowtype.org/docs/troubleshooting.html">
    
    <meta property='og:type' content='website'>
    
    <script type="text/javascript" src="/flowtype/assets/prelude.js"></script>
    <link rel="alternate" type="application/rss+xml" title="Flow" href="http://flowtype.org/blog/feed.xml">
</head>
<body class="">

<header class='topbar'><nav class='width'>
<a href='/flowtype/'>
  <img src="/flowtype/assets/flow-logo.png" alt="Flow logo" class="logo" />
</a>
    <ul>
      <li><a href="/flowtype/docs/getting-started.html#_"
           class="active" >
          文档
      </a></li>
      <li><a href="/flowtype/try/"
          >
          试试
      </a></li>
      <li><a href="/flowtype/support.html"
          >
          支持
      </a></li>
      <li><a href="/flowtype/blog"
          >
          博客
      </a></li>
      <li>
        <input id="algolia-doc-search" type="text" placeholder="Search docs..." />
      </li>
    </ul>
    <ul class="external">
      <li><a href="http://github.com/facebook/flow">官方GitHub</a>
      <li><a href="http://github.com/zhenyong">译者GitHub</a>
    </ul>
</nav></header>


<section class='content'><div class='width'>

<nav class='toc'>
  
    <section>
      <h3>Quick Start</h3>
      <ul>
        
          <li>
            <a href="/flowtype/docs/getting-started.html#_">
              Flow 起步
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/five-simple-examples.html#_">
              五个简单例子
            </a>
            
          </li>
        
      </ul>
    </section>
  
    <section>
      <h3>使用指南</h3>
      <ul>
        
          <li>
            <a href="/flowtype/docs/new-project.html#_">
              开始一个新的 Flow 项目
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/existing.html#_">
              在已有的代码上跑 Flow
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/type-annotations.html#_">
              类型注解
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/third-party.html#_">
              检测第三方模块调用代码
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/running.html#_">
              运行 Flow 代码
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/troubleshooting.html#_" class="active">
              干掉错误
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/cli.html#_">
              命令行工具
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/advanced-configuration.html#_">
              高级配置
            </a>
            
          </li>
        
      </ul>
    </section>
  
    <section>
      <h3>Language Reference</h3>
      <ul>
        
          <li>
            <a href="/flowtype/docs/quick-reference.html#_">
              Quick Reference
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/builtins.html#_">
              Built-in Types
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/syntax.html#_">
              Syntax
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/arrays.html#_">
              Arrays and Tuples
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/classes.html#_">
              Classes
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/objects.html#_">
              Objects
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/functions.html#_">
              Functions
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/nullable-types.html#_">
              Maybe Types
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/destructuring.html#_">
              Destructuring
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/type-aliases.html#_">
              Type Aliases
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/union-intersection-types.html#_">
              Union and Intersection Types
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/typeof.html#_">
              Typeof types
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/dynamic-type-tests.html#_">
              Dynamic Type Tests
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/disjoint-unions.html#_">
              Disjoint Unions
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/modules.html#_">
              Modules
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/declarations.html#_">
              Declarations
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/react.html#_">
              React
            </a>
            
          </li>
        
      </ul>
    </section>
  
</nav>


<article class='withtoc'>
    <h1>干掉错误</h1>
    <p></p>

    <h2>常见错误以及解决方法<a id="section" class="hashref"></a><a href="#section" class="hash">#</a></h2>

<h3>Global not found<a id="global-not-found" class="hashref"></a><a href="#global-not-found" class="hash">#</a></h3>

<p>这类错误是由于代码中引用了全局变量，也可能是由于手贱敲错。
如果是前者，并且你知道运行时是没问题的，
你可以 <a href="/flowtype/docs/third-party.html#interface-files">通过定义接口文件</a> 解决。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre><span class="nx">declare</span> <span class="kd">var</span> <span class="nx">foo</span><span class="err">:</span> <span class="o">&lt;</span><span class="nx">type</span><span class="o">&gt;</span><span class="p">;</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h3>Required module not found<a id="required-module-not-found" class="hashref"></a><a href="#required-module-not-found" class="hash">#</a></h3>

<p>这类错误由于 <code class="highlighter-rouge">require(...)</code> 或者 <code class="highlighter-rouge">import</code> 使用的模块不是 <code class="highlighter-rouge">&lt;根目录&gt;</code> 下的，可以通过下面配置，让 Flow 包含额外的目录。</p>

<div class="highlighter-rouge"><pre class="highlight"><code>[include]
../node_modules/
../lib/
</code></pre>
</div>

<p>如果无没法访问到这些外部模块，又想要声明他们的类型。
这就像上面提到 ‘global not found’ 的情况，你需要创建接口文件，然后配置到 <code class="highlighter-rouge">.flowconfig</code></p>

<div class="language-js highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3</pre></td><td class="code"><pre><span class="nx">declare</span> <span class="nx">module</span> <span class="nx">Bar</span> <span class="p">{</span>
  <span class="p">...</span>
<span class="p">}</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>更多关于创建接口文件的内容，请查看 <a href="third-party.html">这篇指南</a></p>

<p>注意，如果一个模块的实现（源码）和声明（接口文件）都能找到，如果实现上明确要检测（<code class="highlighter-rouge">@flow</code>），
那么就会使用实现的，否则使用声明的。</p>

<h3>Operation not allowed on <code class="highlighter-rouge">null</code> / <code class="highlighter-rouge">undefined</code><a id="operation-not-allowed-on-null--undefined" class="hashref"></a><a href="#operation-not-allowed-on-null--undefined" class="hash">#</a></h3>

<p>Flow 通常认为具体类型和 <code class="highlighter-rouge">null</code> / <code class="highlighter-rouge">undefined</code> 是冲突的 （只有一种兼容的类型是兼容 null 类型的，即 <code class="highlighter-rouge">?&lt;type&gt;</code>）。</p>

<p>所以说，如果发现一个操作可能发生在 <code class="highlighter-rouge">null</code> / <code class="highlighter-rouge">undefined</code> 上，Flow 就会报错，
大家都知道在 null 上操作是会报错的。</p>

<p>解决这类问题的一般思路是先用局部变量存储这个值，然后做个条件判断，
如果不是非法的，再进行操作。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3</pre></td><td class="code"><pre><span class="c1">// var result = foo().bar</span>
<span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="nx">foo</span><span class="p">();</span>
<span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">x</span> <span class="o">!=</span> <span class="kc">null</span> <span class="p">?</span> <span class="nx">x</span><span class="p">.</span><span class="nx">bar</span> <span class="p">:</span> <span class="p">...</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>同样的思路，换个写法：</p>

<div class="language-js highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2</pre></td><td class="code"><pre><span class="c1">// foo.bar()</span>
<span class="nx">foo</span> <span class="o">&amp;&amp;</span> <span class="nx">foo</span><span class="p">.</span><span class="nx">bar</span><span class="p">()</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h3>Function call with too few arguments<a id="function-call-with-too-few-arguments" class="hashref"></a><a href="#function-call-with-too-few-arguments" class="hash">#</a></h3>

<p>在 Javascript 的世界里，方法调用传递的参数可多可少。
多了的参数就多了，少了的参数就会初始化为 <code class="highlighter-rouge">undefined</code>。
Flow 对前者无感，毕竟它无害；不过对后者就会报错。</p>

<p>The most common way to fix these errors is to mark optional parameters with a trailing-<code class="highlighter-rouge">?</code> in the definition for the function being called:</p>

<p>最常见的解决方法，就是在定义函数的参数后面加一个 <code class="highlighter-rouge">?</code>，标记为可选参数</p>

<div class="language-js highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2</pre></td><td class="code"><pre><span class="kd">function</span> <span class="nx">foo</span><span class="p">(</span><span class="nx">x</span><span class="p">?)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
<span class="nx">foo</span><span class="p">();</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>你这么做之后呢，方法的定义又会报错，因为 <code class="highlighter-rouge">x</code> 现在是可选类型，
所以对 <code class="highlighter-rouge">x</code> 操作之前都要作条件判断。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6</pre></td><td class="code"><pre><span class="kd">function</span> <span class="nx">foo</span><span class="p">(</span><span class="nx">x</span><span class="p">?)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">x</span> <span class="o">!=</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// operation on x</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="nx">foo</span><span class="p">();</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>另外，你还可以简单的给 <code class="highlighter-rouge">x</code> 一个默认值，这样就不用作条件保护了</p>

<div class="language-js highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4</pre></td><td class="code"><pre><span class="kd">function</span> <span class="nx">foo</span><span class="p">(</span><span class="nx">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// operation on x</span>
<span class="p">}</span>
<span class="nx">foo</span><span class="p">();</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h3>其他错误<a id="section-1" class="hashref"></a><a href="#section-1" class="hash">#</a></h3>

<p>有些操作运算只对部分值有效。（虽然对别的值使用不会挂，但不是你想要的）</p>

<p>例如，乘操作 (<code class="highlighter-rouge">*</code>) 应该用在数字上，但有时候不小心用在字符串上了
（尽管不会挂掉，但是通常会被转化成 <code class="highlighter-rouge">NaN</code>）</p>

<p>使用 <code class="highlighter-rouge">for-in</code> 遍历应该用在对象上，即便用在数组上也不会报错
（索引被转成字符串或者其它，通常都不是你想要的）</p>

<p>弱等于 <code class="highlighter-rouge">==</code> 应该用在两个类型相同的值上（可是，它会试着偷偷转换类型再比较）</p>

<p>Flow 会对包括以上的这类用法报错，因为它们是潜在的危险。
对于这些不良代码，通常都有一个安全的方式来改写，例如，
举例中的后两种，可以使用 <code class="highlighter-rouge">Array.forEach</code> 和 <code class="highlighter-rouge">===</code> 来解决，
而第一种可以用 <code class="highlighter-rouge">Number(...)</code></p>



    <p class="docs-prevnext">
      
        <a href="/flowtype/docs/running.html#_">&larr; Prev</a>
      
      
        <a class="right" href="/flowtype/docs/cli.html#_">Next &rarr;</a>
      
    </p>

    <p class="edit-page-block">
      You can
      <a href="https://github.com/facebook/flow/tree/master/website/docs/02-troubleshooting.md" target="_blank">
        edit this page on GitHub
      </a>
      and send us a pull request!
    </p>

    <a id="_"></a>
</article>

</div></section>

<footer><div class='width'>
    &copy; Copyright 2014 - 2016, Facebook Inc.
</div></footer>

<script>require(['default']);</script>
</body>
</html>

