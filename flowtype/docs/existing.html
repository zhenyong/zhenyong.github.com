<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns#">
<head>
    <meta charset='utf-8'>
    <title>Flow | Running Flow on existing code</title>
    <link href='https://fonts.googleapis.com/css?family=Roboto+Mono' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css" />
    <link type="text/css" rel="stylesheet" href="/flowtype/assets/default.css">
    <link type="text/css" rel="stylesheet" href="/flowtype/assets/syntax.css">
    <link rel='shortcut icon' href='/flowtype/static/favicon.png'>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta property="og:title" content="Running Flow on existing code" />
    <meta property="og:site_name" content="flowtype">
    <meta property='og:description' content='Flow is a static type checker for
    JavaScript.'>
    <meta property='og:image' content='http://flowtype.org/static/flow-og-image.png'>
    <meta property='og:url' content="http://flowtype.org/docs/existing.html">
    
    <meta property='og:type' content='website'>
    
    <script type="text/javascript" src="/flowtype/assets/prelude.js"></script>
    <link rel="alternate" type="application/rss+xml" title="Flow" href="http://flowtype.org/blog/feed.xml">
</head>
<body class="">

<header class='topbar'><nav class='width'>
<a href='/flowtype/'>
  <img src="/flowtype/assets/flow-logo.png" alt="Flow logo" class="logo" />
</a>
    <ul>
      <li><a href="/flowtype/docs/getting-started.html#_"
           class="active" >
          文档
      </a></li>
      <li><a href="/flowtype/try/"
          >
          试试
      </a></li>
      <li><a href="/flowtype/support.html"
          >
          支持
      </a></li>
      <li><a href="/flowtype/blog"
          >
          博客
      </a></li>
      <li>
        <input id="algolia-doc-search" type="text" placeholder="Search docs..." />
      </li>
    </ul>
    <ul class="external">
      <li><a href="http://github.com/facebook/flow">GitHub</a>
    </ul>
</nav></header>


<section class='content'><div class='width'>

<nav class='toc'>
  
    <section>
      <h3>Quick Start</h3>
      <ul>
        
          <li>
            <a href="/flowtype/docs/getting-started.html#_">
              Flow 起步
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/five-simple-examples.html#_">
              五个简单例子
            </a>
            
          </li>
        
      </ul>
    </section>
  
    <section>
      <h3>User Guide</h3>
      <ul>
        
          <li>
            <a href="/flowtype/docs/new-project.html#_">
              Starting a new Flow project
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/existing.html#_" class="active">
              Running Flow on existing code
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/type-annotations.html#_">
              Adding Type Annotations
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/third-party.html#_">
              Checking third-party code
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/running.html#_">
              Running Flow code
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/troubleshooting.html#_">
              Troubleshooting
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/cli.html#_">
              Using the CLI
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/advanced-configuration.html#_">
              Advanced Configuration
            </a>
            
          </li>
        
      </ul>
    </section>
  
    <section>
      <h3>Language Reference</h3>
      <ul>
        
          <li>
            <a href="/flowtype/docs/quick-reference.html#_">
              Quick Reference
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/builtins.html#_">
              Built-in Types
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/syntax.html#_">
              Syntax
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/arrays.html#_">
              Arrays and Tuples
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/classes.html#_">
              Classes
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/objects.html#_">
              Objects
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/functions.html#_">
              Functions
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/nullable-types.html#_">
              Maybe Types
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/destructuring.html#_">
              Destructuring
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/type-aliases.html#_">
              Type Aliases
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/union-intersection-types.html#_">
              Union and Intersection Types
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/typeof.html#_">
              Typeof types
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/dynamic-type-tests.html#_">
              Dynamic Type Tests
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/disjoint-unions.html#_">
              Disjoint Unions
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/modules.html#_">
              Modules
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/declarations.html#_">
              Declarations
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/react.html#_">
              React
            </a>
            
          </li>
        
      </ul>
    </section>
  
</nav>


<article class='withtoc'>
    <h1>Running Flow on existing code</h1>
    <p></p>

    <h2>A word of warning<a id="a-word-of-warning" class="hashref"></a><a href="#a-word-of-warning" class="hash">#</a></h2>

<p>Making previously-untyped code typecheck with Flow may take some time and work - and sometimes it may not be worth the effort in the short term. Flow supports <em>interface files</em> so you can use libraries in a typed way without having to run Flow on them at all. If your project just depends on third party libraries, check out our <a href="third-party.html">guide</a> on using Flow with external dependencies and consider using an interface file for the libraries.</p>

<p>Why is typechecking existing code so hard? Libraries not written with types in mind often contain complex, highly dynamic code that confuses analyzers such as Flow. The code may also have been written in a style that Flow deliberately chooses not to support in order to give the programmer more help. Some typical examples are:</p>

<ul>
  <li>Operations on primitive values: While JavaScript allows operations such as <code class="highlighter-rouge">true + 3</code>, Flow considers it a type error. This is by design, and is done to provide the programmer with more safety. While that’s easily avoided for new code, it can sometimes be a lot of effort to eliminate such patterns from existing code.</li>
  <li>Nullability: Flow protects you against accessing properties on <code class="highlighter-rouge">null</code> by tracking null or undefined values throughout the program. In large existing codebases, though, this can require inserting some extra null checks in places where a value appears like it may be null, but actually isn’t at runtime.</li>
</ul>

<p>It is typically a much larger effort, and requires much more programmer annotation, to get such code to typecheck. On the other hand, if you own a library and would like to benefit from Flow typechecking within the library itself, this guide is for you.</p>

<h2>Weak mode<a id="weak-mode" class="hashref"></a><a href="#weak-mode" class="hash">#</a></h2>

<p>Flow has a special mode, known as <em>weak mode</em>, to get started with complex library code without having to pay the full cost up front. The difference between weak mode and regular mode is how Flow deals with missing type annotations. In regular mode Flow will infer types for all missing annotations, and produce errors whenever it detects a mismatch. In weak mode, Flow will do much less type inference. It will still infer types within functions, but will otherwise treat unannotated variables as having the <a href="base-types.html#any"><code class="highlighter-rouge">any</code></a> type - meaning no typechecking happens on them.</p>

<p>A good first step towards typechecking existing library code is to use weak mode, rather than regular mode. Simply change the header declaration in the file you want to typecheck:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre><span class="cm">/* @flow weak */</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>Weak mode can still point out type problems, and likely will, but there will be far fewer and they will be easier to fix. This should give you some benefit straight away without too much work. The typical errors you are likely to run into are:</p>

<ul>
  <li>Potentially <code class="highlighter-rouge">null</code> or <code class="highlighter-rouge">undefined</code> values, easily fixed by adding conditional checks.</li>
  <li>Primitive type issues, like <code class="highlighter-rouge">true + 3</code>. Fixing these requires more knowledge of the code but is usually a small, local fix.</li>
  <li>In cases where Flow just doesn’t understand the code as written, <a href="/flowtype/blog/2015/02/18/Typecasts.html">explicitly annotating values with <code class="highlighter-rouge">any</code></a> can help the typechecker.</li>
</ul>

<p>Weak mode typically produces a manageable number of errors, so you can get down to zero errors in weak mode with moderate effort.</p>

<h2>下一步<a id="section" class="hashref"></a><a href="#section" class="hash">#</a></h2>

<p>Once your code typechecks with Flow’s weak mode, you can start adding type annotations incrementally. Each type annotation you add will allow Flow to validate more code, and you can gradually increase Flow’s coverage of your code.</p>

<p>Once your code has more type annotations, you can consider switching it over to regular flow mode by switching the comment at the top of the file to</p>

<div class="language-js highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre><span class="cm">/* @flow */</span>
</pre></td></tr></tbody></table>
</div>
</div>


    <p class="docs-prevnext">
      
        <a href="/flowtype/docs/new-project.html#_">&larr; Prev</a>
      
      
        <a class="right" href="/flowtype/docs/type-annotations.html#_">Next &rarr;</a>
      
    </p>

    <p class="edit-page-block">
      You can
      <a href="https://github.com/facebook/flow/tree/master/website/docs/02-existing.md" target="_blank">
        edit this page on GitHub
      </a>
      and send us a pull request!
    </p>

    <a id="_"></a>
</article>

</div></section>

<footer><div class='width'>
    &copy; Copyright 2014 - 2016, Facebook Inc.
</div></footer>

<script>require(['default']);</script>
</body>
</html>

