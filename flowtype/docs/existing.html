<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns#">
<head>
    <meta charset='utf-8'>
    <title>Flow | 在已有的代码上跑 Flow</title>
    <link href='https://fonts.googleapis.com/css?family=Roboto+Mono' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css" />
    <link type="text/css" rel="stylesheet" href="/flowtype/assets/default.css">
    <link type="text/css" rel="stylesheet" href="/flowtype/assets/syntax.css">
    <link rel='shortcut icon' href='/flowtype/static/favicon.png'>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta property="og:title" content="在已有的代码上跑 Flow" />
    <meta property="og:site_name" content="flowtype">
    <meta property='og:description' content='Flow is a static type checker for
    JavaScript.'>
    <meta property='og:image' content='http://flowtype.org/static/flow-og-image.png'>
    <meta property='og:url' content="http://flowtype.org/docs/existing.html">
    
    <meta property='og:type' content='website'>
    
    <script type="text/javascript" src="/flowtype/assets/prelude.js"></script>
    <link rel="alternate" type="application/rss+xml" title="Flow" href="http://flowtype.org/blog/feed.xml">
</head>
<body class="">

<header class='topbar'><nav class='width'>
<a href='/flowtype/'>
  <img src="/flowtype/assets/flow-logo.png" alt="Flow logo" class="logo" />
</a>
    <ul>
      <li><a href="/flowtype/docs/getting-started.html#_"
           class="active" >
          文档
      </a></li>
      <li><a href="/flowtype/try/"
          >
          试试
      </a></li>
      <li><a href="/flowtype/support.html"
          >
          支持
      </a></li>
      <li><a href="/flowtype/blog"
          >
          博客
      </a></li>
      <li>
        <input id="algolia-doc-search" type="text" placeholder="Search docs..." />
      </li>
    </ul>
    <ul class="external">
      <li><a href="http://github.com/facebook/flow">官方GitHub</a>
      <li><a href="http://github.com/zhenyong">译者GitHub</a>
    </ul>
</nav></header>


<section class='content'><div class='width'>

<nav class='toc'>
  
    <section>
      <h3>Quick Start</h3>
      <ul>
        
          <li>
            <a href="/flowtype/docs/getting-started.html#_">
              Flow 起步
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/five-simple-examples.html#_">
              五个简单例子
            </a>
            
          </li>
        
      </ul>
    </section>
  
    <section>
      <h3>使用指南</h3>
      <ul>
        
          <li>
            <a href="/flowtype/docs/new-project.html#_">
              开始一个新的 Flow 项目
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/existing.html#_" class="active">
              在已有的代码上跑 Flow
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/type-annotations.html#_">
              Adding 类型注解
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/third-party.html#_">
              检测第三方模块调用代码
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/running.html#_">
              Running Flow code
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/troubleshooting.html#_">
              Troubleshooting
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/cli.html#_">
              Using the CLI
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/advanced-configuration.html#_">
              Advanced Configuration
            </a>
            
          </li>
        
      </ul>
    </section>
  
    <section>
      <h3>Language Reference</h3>
      <ul>
        
          <li>
            <a href="/flowtype/docs/quick-reference.html#_">
              Quick Reference
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/builtins.html#_">
              Built-in Types
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/syntax.html#_">
              Syntax
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/arrays.html#_">
              Arrays and Tuples
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/classes.html#_">
              Classes
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/objects.html#_">
              Objects
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/functions.html#_">
              Functions
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/nullable-types.html#_">
              Maybe Types
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/destructuring.html#_">
              Destructuring
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/type-aliases.html#_">
              Type Aliases
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/union-intersection-types.html#_">
              Union and Intersection Types
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/typeof.html#_">
              Typeof types
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/dynamic-type-tests.html#_">
              Dynamic Type Tests
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/disjoint-unions.html#_">
              Disjoint Unions
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/modules.html#_">
              Modules
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/declarations.html#_">
              Declarations
            </a>
            
          </li>
        
          <li>
            <a href="/flowtype/docs/react.html#_">
              React
            </a>
            
          </li>
        
      </ul>
    </section>
  
</nav>


<article class='withtoc'>
    <h1>在已有的代码上跑 Flow</h1>
    <p></p>

    <h2>提醒<a id="section" class="hashref"></a><a href="#section" class="hash">#</a></h2>

<p>对原先没有使用类型注解的代码使用 Flow，需要花点时间，而且短期内体现不出什么价值。
Flow 支持 <em>接口定义文件</em>，所以你不一定要对已有模块进行 Flow 检测，你可以对已有模块定义类型，然后使用时就带有类型检测功能了。
如果你的项目依赖第三方库，请查看 <a href="third-party.html">指南</a> ，了解如何使用 Flow 配合第三方库，定义它们的接口文件。</p>

<p>为什么对现有代码作类型检测很难呢？
某些代码不带类型，通常是因为代码复杂、动态逻辑特别多，然后解析器无法很好理解、探测。
还有一些代码风格是 Flow 故意不建议的，是为了更好的帮助开发者，像下面这些典型例子：</p>

<ul>
  <li>
    <p>primitive 值运算：js 允许这样运算，如 <code class="highlighter-rouge">true + 3</code>，
不过 Flow 认为这是个类型错误。
Flow 设计如此，希望开发者编写更安全的代码。
以后新添加的代码都能避开这种潜在危险了，
甚至有时候对已有代码过滤一下这类错误也是很有用的。</p>
  </li>
  <li>
    <p>null 值：Flow 通过跟踪程序内 null 或者 undefined 的值，在你可能访问到 <code class="highlighter-rouge">null</code> 值的
属性时，给你提醒保护。虽然不是发生在运行时，但它依然能探测到，并且需要你在一些可能是 null 的地方加一些判断代码，保证安全。</p>
  </li>
</ul>

<p>为了让这些代码作类型检测，真的得花上更多的精力，而且要添加好多类型注解。
不过话说回来，如果你有一个库然后想相对它使用 Flow，这些指南是适合你的。</p>

<h2>弱模式<a id="section-1" class="hashref"></a><a href="#section-1" class="hash">#</a></h2>

<p>Flow 有一个特殊模式，叫 <em>弱模式</em>, 适合复杂项目开展前期，让你无须过早的付出太多时间。
弱模式和正常模式的区别在于 Flow 如何对待遗漏的类型注解。在正常模式下，Flow 对缺少
类型注解的地方探测类型，然后输出相应错误。但是在弱模式下，Flow 就不做那么多类型检测，
对方法内的类型还是会探测，但是对其他未注解的变量，会认为他们可以是 <a href="base-types.html#any"><code class="highlighter-rouge">any</code> 任何类型</a>——也就意味着无须检测</p>

<p>对于一个现有的库来说，先用弱模式比较好，只需要修改注释为：</p>

<div class="language-js highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre><span class="cm">/* @flow weak */</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>弱模式依然会给出类型错误，不过可能给的更少，比较容易修复。
这能给你直接带来好处又无须太多工作。
通常给出的错误都是你想要的：</p>

<ul>
  <li>
    <p>潜在的 <code class="highlighter-rouge">null</code> 或者 <code class="highlighter-rouge">undefined</code> 问题, 加个条件判断就完了</p>
  </li>
  <li>
    <p>primitive 类型错误：例如 <code class="highlighter-rouge">true + 3</code>. 需要一点语法知识解决，不过都是一些小改动</p>
  </li>
  <li>
    <p>Flow 不懂你的代码，那就 <a href="/flowtype/blog/2015/02/18/Typecasts.html">注解为 <code class="highlighter-rouge">any</code> 任何类型</a>，
让检测器更容易理解</p>
  </li>
</ul>

<p>通常，弱模式给出的错误数不多而且都好解决，然后你又能得到一定好处。</p>

<h2>下一步<a id="section-2" class="hashref"></a><a href="#section-2" class="hash">#</a></h2>

<p>一旦你使用弱模式检测，你可以着手添加逐渐添加类型注解。每增加一个类型注解，Flow 就能检测
更多的代码，你就能逐步的将 Flow 检测覆盖所有代码</p>

<p>随着你的类型注解逐渐完整，你可以考虑切换到正常模式，也就是改下注释。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre><span class="cm">/* @flow */</span>
</pre></td></tr></tbody></table>
</div>
</div>


    <p class="docs-prevnext">
      
        <a href="/flowtype/docs/new-project.html#_">&larr; Prev</a>
      
      
        <a class="right" href="/flowtype/docs/type-annotations.html#_">Next &rarr;</a>
      
    </p>

    <p class="edit-page-block">
      You can
      <a href="https://github.com/facebook/flow/tree/master/website/docs/02-existing.md" target="_blank">
        edit this page on GitHub
      </a>
      and send us a pull request!
    </p>

    <a id="_"></a>
</article>

</div></section>

<footer><div class='width'>
    &copy; Copyright 2014 - 2016, Facebook Inc.
</div></footer>

<script>require(['default']);</script>
</body>
</html>

